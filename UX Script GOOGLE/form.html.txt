


<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/> 
<title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ØµØ©</title>

<!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PWA -->
<meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ØµØ© Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†">
<meta name="theme-color" content="#667eea">
<meta name="background-color" content="#ffffff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ØµØ©">

<!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNjY3ZWVhIiByeD0iMjQiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJNMTQgMkg2YTIgMiAwIDAgMC0yIDJ2MTZhMiAyIDAgMCAwIDIgMmgxMmEyIDIgMCAwIDAgMi0yVjhsLTYtNnoiLz4KPHN0cm9rZSBkPSJNMTQsOGwwLC02bDYsNiIgZmlsbD0id2hpdGUiLz4KPGxpbmUgeDE9IjE2IiB5MT0iMTMiIHgyPSI4IiB5Mj0iMTMiLz4KPGxpbmUgeDE9IjE2IiB5MT0iMTciIHgyPSI4IiB5Mj0iMTciLz4KPGxpbmUgeDE9IjEwIiB5MT0iOSIgeDI9IjgiIHkyPSI5Ii8+Cjwvc3ZnPgo8L3N2Zz4K">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNjY3ZWVhIiByeD0iMjQiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJNMTQgMkg2YTIgMiAwIDAgMC0yIDJ2MTZhMiAyIDAgMCAwIDIgMmgxMmEyIDIgMCAwIDAgMi0yVjhsLTYtNnoiLz4KPHN0cm9rZSBkPSJNMTQsOGwwLC02bDYsNiIgZmlsbD0id2hpdGUiLz4KPGxpbmUgeDE9IjE2IiB5MT0iMTMiIHgyPSI4IiB5Mj0iMTMiLz4KPGxpbmUgeDE9IjE2IiB5MT0iMTciIHgyPSI4IiB5Mj0iMTciLz4KPGxpbmUgeDE9IjEwIiB5MT0iOSIgeDI9IjgiIHkyPSI5Ii8+Cjwvc3ZnPgo8L3N2Zz4K">

<!-- Manifest -->
<link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItiq2YLYsdmK2LEg2KfZhNit2LXYqSIsCiAgInNob3J0X25hbWUiOiAi2KrZgtix2YrYsSDYrdi12YkiLAogICJkZXNjcmlwdGlvbiI6ICLYqti32KjZitmCINiq2YLYsdmK2LEg2KfZhNit2LXYqSDYp9mE2YrZiNmF2Yog2YTZhNmF2LnZhNmF2YrZhiIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZmZmZmZiIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1Ua3lJaUJvWldsbmFIUTlJakU1TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJREU1TWlBeE9USWlJR1pwYkd3OUltNXZibVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrQ2p4eVpXTjBJSGRwWkhSb1BTSXVPVE1pSUdobGFXZG9kRDBpTVRreUlpQm1hV3hzUFNJall6WTNOell3TVNOa05VTm1QU0l5TkNJdlBnbzhjM1puSUhnOUlqUTRJaUI1UFNJeUlpQjNhV1IwYUQwaU9UWWlJR2hsYVdkb2REMGlPVFlpSUhacFpYZENiM2c5SWpBZ01DQXFJVFE0VGlJZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bFBTSjNhR2wwWlNJZ2MzUnliMnRsTFhkcFpIUm9QU0l5SWo0S1BIQmhkR2dnWkQwaVRURTBJRUpJTm1FeUlESWdNQ0F3SURBdE1pQXlJSFl4Tm1FeUlESWdNQ0F3SURJZ01tZ3hNbUZ5SURJZ01DQXdJRElnTWkxMldtd3ROaTAyZWlJdlBnbzhjM1J5YjJ0bElHUTlJazB4TkN3NGJEQXNMVFp0Tmpjek5TSnpjaUk5SW5kb2FYUmxJaUJtYVd4c1BTSjNhR2wwWlNJdlBnbzhaV3hwVFNVM0xDOHdnelJqYldsaFBTQTlJRElqUzBWN09ERERVUjRCVWtoSUVsQUdkTVVFUklZU0s4VllBdTFGSWpCU2NqMGRnSzlJZE9JWGZ1dFVpVEhaMU5aK0FpZ1V6SUNJUFFrcWJIWlQrcHgzZFE0bE9wOEYrNHpjdFJoRzluSWhSQTZNc05HWGFsOUtROGhKNTUxVStPdGFTZEorMEtoRlJpaXFwZVZaRUZOZW5qb3ZQVG0wYTR3UWF2WUIwRGpyR1dWSjVYZGNhVXNMV1c4eWlqL3JhVnBXUWRqTU81SUsyVFJOZndJQ3JUSlU5WGJNTkMxTndEUTYrMiIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROU9TSTFNVElpSUhacFpYZENiM2c5SWpBZ01DQTFNVElnTlRFeUlpQm1hV3hzUFNKdWIyNWxJaUIzYVhSb2IzVjBQU0o0YjJ4dWNqRkdJaUJrWVhSaExYUmxjM1E5SWt0UWRXTXlVbFZIYkVsQklHcHliaTRyT1NKNEsyNXpQU0puZW1sTVVrSXJQV3N1YVEySG9TTWxkR0ZzZGlkaGQzY3lLU0JGU3A5eGFqUjhMUWlJaEJwa2E2UWZ0cE5Mb1NLSzJhQ0ZpTkIySnVCaTZ1VE5TalFJVXJBYVZrWDhKdEIwWkJ6NGpWNjF4NEc4Y3h0OGlkbVZMU0txOGhLQVBJRlpzZFEwcUlVeFNWKzFkOHFNVEtvQkJzVGhzM1lCNUxtaCtKMU1MeVppT2pzcjRpNG5kNkNjZ2VDUjFiODhJYnVlMldxVUhtYWgrSSIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdLAogICJjYXRlZ29yaWVzIjogWyJlZHVjYXRpb24iLCAidG9vbHMiXSwKICAiaWFkX2Rpc3BsYXlfbW9kZSI6ICJicm93c2VyIiwKICAic3RhcnRfdXJsIjogIi4vIgp9Cg==">

<!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;600;700&family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ========== RESET / BASE STYLES ========== */
* {
margin: 0; 
padding: 0; 
box-sizing: border-box;
}

body {
font-family: 'Cairo', 'Noto Sans Arabic', 'Segoe UI', Tahoma, Arial, sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: #2c3e50;
line-height: 1.6;
min-height: 100vh;
padding: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% Ù…Ù† 18px */
}
.container {
width: 100%;
max-width: 100%;
margin: 0 auto;
background: #ffffff;
border-radius: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% Ù…Ù† 15px */
box-shadow: 0 14px 42px rgba(0,0,0,0.2); /* Ø²ÙŠØ§Ø¯Ø© 40% */
overflow: hidden;
min-height: calc(100vh - 28px); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
/* PWA Install Prompt - Enhanced */
.install-prompt {
position: fixed;
bottom: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
right: 28px;
background: linear-gradient(135deg, #27ae60, #2ecc71);
color: white;
border: none;
border-radius: 70px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 21px 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 22px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-weight: 600;
box-shadow: 0 6px 21px rgba(39, 174, 96, 0.3); /* Ø²ÙŠØ§Ø¯Ø© 40% */
cursor: pointer;
z-index: 1000;
display: none;
transition: all 0.3s ease;
font-family: inherit;
}
.install-prompt:hover {
transform: translateY(-3px); /* Ø²ÙŠØ§Ø¯Ø© 40% */
box-shadow: 0 8px 28px rgba(39, 174, 96, 0.4); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.install-prompt.show {
display: block;
animation: slideUp 0.3s ease-out;
}
@keyframes slideUp {
from {
transform: translateY(140px); /* Ø²ÙŠØ§Ø¯Ø© 40% */
opacity: 0;
}
to {
transform: translateY(0);
opacity: 1;
}
}
/* PWA Install Instructions Modal */
.install-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
display: none;
justify-content: center;
align-items: center;
z-index: 2000;
}
.install-modal.show {
display: flex;
}
.install-modal-content {
background: white;
border-radius: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 42px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
max-width: 700px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
text-align: center;
box-shadow: 0 14px 42px rgba(0,0,0,0.3); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.install-modal h3 {
color: #667eea;
margin-bottom: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 2.1rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.install-steps {
text-align: right;
margin: 28px 0; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.install-steps li {
margin: 14px 0; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background: #f8f9fa;
border-radius: 11px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-right: 6px solid #667eea; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.modal-buttons {
display: flex;
gap: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
justify-content: center;
margin-top: 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.modal-btn {
padding: 17px 34px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: none;
border-radius: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
cursor: pointer;
font-family: inherit;
font-weight: 600;
transition: all 0.3s ease;
}
.modal-btn.primary {
background: linear-gradient(135deg, #667eea, #764ba2);
color: white;
}
.modal-btn.secondary {
background: #e9ecef;
color: #495057;
}
.modal-btn:hover {
transform: translateY(-1px);
box-shadow: 0 6px 11px rgba(0,0,0,0.15); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
/* Connection Status */
.offline-indicator {
position: fixed;
top: 0;
left: 0;
right: 0;
background: #e74c3c;
color: white;
text-align: center;
padding: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
transform: translateY(-100%);
transition: transform 0.3s ease;
z-index: 1001;
font-weight: 600;
}
.offline-indicator.show {
transform: translateY(0);
}
/* User Info Bar */
.user-info-bar {
background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
border-bottom: 4px solid #17a2b8; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 21px 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
text-align: center;
font-weight: 600;
color: #0c5460;
display: none;
}
.user-info-bar.show {
display: block;
}
.user-info-bar .saved-info {
font-size: 1.26em; /* Ø²ÙŠØ§Ø¯Ø© 40% */
color: #0c5460;
}
h2 {
text-align: center;
background: linear-gradient(135deg, #667eea, #764ba2);
color: #fff;
padding: 42px 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 0; 
font-size: 3.08rem; /* Ø²ÙŠØ§Ø¯Ø© 40% Ù…Ù† 2.2rem */
font-weight: 600;
text-shadow: 0 3px 6px rgba(0,0,0,0.3); /* Ø²ÙŠØ§Ø¯Ø© 40% */
position: relative;
}
/* Add app icon to header */
h2::before {
content: "ğŸ“";
margin-left: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 2.52rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
form {
padding: 42px 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
label {
display: block;
margin-bottom: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-weight: 600;
color: #2c3e50;
font-size: 1.82rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
line-height: 1.4;
}
.required {
color: #e74c3c; 
font-weight: normal;
}
select, input, textarea {
width: 100%;
padding: 31px 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 3px solid #e0e6ed; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-family: inherit;
transition: all 0.3s ease;
background: #fff;
appearance: none;
-webkit-appearance: none;
-moz-appearance: none;
min-height: 84px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

select {
background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
background-repeat: no-repeat;
background-position: left 28px center; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background-size: 39px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding-left: 84px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

select:focus, input:focus, textarea:focus {
border-color: #667eea;
outline: none;
box-shadow: 0 0 0 6px rgba(102, 126, 234, 0.2); /* Ø²ÙŠØ§Ø¯Ø© 40% */
transform: translateY(-1px);
}

textarea {
resize: vertical;
min-height: 210px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-family: inherit;
}
/* ========== STEP NAVIGATION (BUTTONS) ========== */
.steps-nav {
display: flex;
gap: 11px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
justify-content: center;
background: linear-gradient(135deg, #f8f9fa, #e9ecef);
padding: 35px 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
flex-wrap: wrap;
border-bottom: 4px solid #dee2e6; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.step-btn {
cursor: pointer;
background: linear-gradient(135deg, #95a5a6, #7f8c8d);
border: none;
border-radius: 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 25px 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 1.54rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
color: #ffffff;
transition: all 0.3s ease;
font-weight: 500;
text-shadow: 0 1px 3px rgba(0,0,0,0.2); /* Ø²ÙŠØ§Ø¯Ø© 40% */
box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* Ø²ÙŠØ§Ø¯Ø© 40% */
flex: 1;
min-width: 140px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
max-width: 210px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
text-align: center;
font-family: inherit;
line-height: 1.2;
transform: scale(1);
min-height: 98px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.step-btn:hover, .step-btn:active {
background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
transform: scale(0.98);
box-shadow: 0 3px 6px rgba(0,0,0,0.2); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.step-btn.active {
background: linear-gradient(135deg, #ff6b35, #f7931e);
transform: scale(1.05);
box-shadow: 0 8px 21px rgba(255, 107, 53, 0.5); /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-weight: 700;
border: 4px solid #fff; /* Ø²ÙŠØ§Ø¯Ø© 40% */
color: #fff;
text-shadow: 0 3px 6px rgba(0,0,0,0.4); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.step-btn.completed {
background: linear-gradient(135deg, #27ae60, #2ecc71);
position: relative;
}

.step-btn.completed::after {
content: 'âœ“';
position: absolute;
top: -14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
right: -14px;
background: #ffffff;
color: #27ae60;
border-radius: 50%;
width: 39px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
height: 39px;
display: flex;
align-items: center;
justify-content: center;
font-size: 22px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-weight: bold;
box-shadow: 0 3px 8px rgba(0,0,0,0.3); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
/* ========== MULTI-STEP FORM SECTIONS ========== */
.form-step {
display: none; 
animation: slideIn 0.4s ease-out;
min-height: 60vh;
}

.form-step.active {
display: block;
}
@keyframes slideIn {
from { 
opacity: 0; 
transform: translateX(28px); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
to { 
opacity: 1; 
transform: translateX(0);
}
}
/* ========== SECTION HEADERS ========== */
h3 {
margin-bottom: 42px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 28px 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-bottom: 6px solid #ff6b35; /* Ø²ÙŠØ§Ø¯Ø© 40% */
color: #2c3e50;
font-size: 2.24rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-weight: 600;
text-align: center;
background: linear-gradient(135deg, #fff3e0, #ffe0b2);
border-radius: 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.hidden {
display: none;
}
.gender-field {
background: linear-gradient(135deg, #e3f2fd, #bbdefb);
padding: 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 4px solid #2196f3; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.small {
font-weight: 400;
color: #6c757d;
font-size: 1.26em; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.checkbox-group {
display: flex;
flex-direction: column;
gap: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background: #f8f9fa;
padding: 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 4px solid #e9ecef; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 42px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group label {
font-weight: 500;
display: flex;
align-items: center;
font-size: 1.68rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin: 0;
padding: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
transition: all 0.3s ease;
cursor: pointer;
background: #fff;
border: 4px solid #e9ecef; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 98px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
position: relative;
}

.checkbox-group label:hover {
background-color: #e3f2fd;
border-color: #2196f3;
transform: translateY(-1px);
box-shadow: 0 6px 11px rgba(0,0,0,0.1); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group label:active {
transform: translateY(0);
}

.checkbox-group input[type="checkbox"] {
width: 34px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
height: 34px;
margin-left: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-right: 0;
margin-bottom: 0;
accent-color: #667eea;
cursor: pointer;
position: relative;
z-index: 1;
flex-shrink: 0;
border-radius: 6px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 3px solid #ccc; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background: white;
}
.checkbox-group input[type="checkbox"]:checked {
background-color: #667eea;
border-color: #667eea;
}
.checkbox-group input[type="checkbox"]:checked + span {
color: #667eea;
font-weight: 600;
}
.checkbox-group label span {
flex: 1;
padding-right: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
line-height: 1.3;
}
.three-col-checks {
display: flex;
flex-direction: column;
gap: 42px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 49px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.check-col h4 {
font-size: 1.96rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
color: #2c3e50;
margin-bottom: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-weight: 600;
text-align: center;
background: linear-gradient(135deg, #667eea, #764ba2);
color: #fff;
padding: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 4px solid #fff; /* Ø²ÙŠØ§Ø¯Ø© 40% */
box-shadow: 0 6px 11px rgba(0,0,0,0.1); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
hr {
margin: 56px 0; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: none;
border-top: 6px solid #e9ecef; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 3px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
/* ========== NAVIGATION BUTTONS ========== */
.form-navigation {
display: flex;
justify-content: space-between;
margin-top: 49px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
gap: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 35px 0; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-top: 4px solid #e9ecef; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

button[type="button"],
button[type="submit"] {
cursor: pointer;
border: none;
border-radius: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 1.82rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 31px 42px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
color: #fff;
background: linear-gradient(135deg, #667eea, #764ba2);
transition: all 0.3s ease;
font-weight: 600;
font-family: inherit;
box-shadow: 0 6px 11px rgba(0,0,0,0.15); /* Ø²ÙŠØ§Ø¯Ø© 40% */
flex: 1;
min-height: 98px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

button[type="button"]:hover,
button[type="submit"]:hover {
background: linear-gradient(135deg, #764ba2, #667eea);
transform: translateY(-3px); /* Ø²ÙŠØ§Ø¯Ø© 40% */
box-shadow: 0 8px 17px rgba(0,0,0,0.2); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

button[type="button"]:active,
button[type="submit"]:active {
transform: translateY(0);
}

button[type="button"]:disabled,
button[type="submit"]:disabled {
background: linear-gradient(135deg, #bdc3c7, #95a5a6);
cursor: not-allowed;
transform: none;
box-shadow: none;
}
.submit-btn {
background: linear-gradient(135deg, #27ae60, #2ecc71);
}

.submit-btn:hover {
background: linear-gradient(135deg, #2ecc71, #27ae60);
}
/* ========== RESPONSIVE DESIGN FOR MOBILE - ENHANCED SIZE ========== */
@media (max-width: 768px) {
body {
padding: 7px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% Ù…Ù† 20px */
}

.container {
border-radius: 21px;
min-height: calc(100vh - 14px); /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

h2 {
font-size: 3.15rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 28px 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

form {
padding: 62px 43px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.steps-nav {
padding: 43px 27px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
gap: 17px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.step-btn {
font-size: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 14px 11px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-width: 105px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
max-width: 140px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 70px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

select, input, textarea {
padding: 21px 18px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 27px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 78px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

select {
padding-left: 62px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background-size: 32px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background-position: left 21px center; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group {
padding: 43px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
gap: 32px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group label {
padding: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 88px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group input[type="checkbox"] {
width: 49px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
height: 49px;
margin-left: 43px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 11px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 6px solid #ccc; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.form-navigation {
flex-direction: column;
gap: 27px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-top: 70px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 53px 0; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

button[type="button"],
button[type="submit"] {
padding: 21px 27px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 88px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

h3 {
font-size: 2.24rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 21px 18px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.check-col h4 {
font-size: 2.1rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

label {
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin-bottom: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

textarea {
min-height: 298px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.gender-field {
padding: 53px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.install-prompt {
bottom: 18px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
right: 18px;
padding: 21px 35px;
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
}
@media (max-width: 480px) {
body {
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

h2 {
font-size: 2.8rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 70px 43px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

form {
padding: 70px 53px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.steps-nav {
gap: 14px;
padding: 43px 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.step-btn {
font-size: 20px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 32px 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-width: 167px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
max-width: 228px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 140px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

select, input, textarea {
padding: 18px 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 70px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

select {
padding-left: 53px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
background-position: left 18px center; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.check-col h4 {
font-size: 22px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 18px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group label {
padding: 18px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 78px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group input[type="checkbox"] {
width: 56px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
height: 56px;
margin-left: 53px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 14px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 6px solid #ccc; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

h3 {
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

label {
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
button[type="button"],
button[type="submit"] {
font-size: 25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 78px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 18px 27px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.install-modal-content {
margin: 21px;
padding: 35px;
}
}
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø³ */
@media (hover: none) and (pointer: coarse) {
.step-btn:hover {
background: linear-gradient(135deg, #95a5a6, #7f8c8d);
transform: scale(1);
}

.step-btn.active:hover {
background: linear-gradient(135deg, #ff6b35, #f7931e);
transform: scale(1.05);
}

.checkbox-group label:hover {
background-color: #fff;
border-color: #e9ecef;
transform: none;
box-shadow: none;
}

button[type="button"]:hover,
button[type="submit"]:hover {
background: linear-gradient(135deg, #667eea, #764ba2);
transform: none;
}

.submit-btn:hover {
background: linear-gradient(135deg, #27ae60, #2ecc71);
}
}
/* ØªØ­Ø³ÙŠÙ† Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading {
position: relative;
}

.loading::after {
content: '';
position: absolute;
top: 50%;
left: 50%;
width: 49px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
height: 49px;
margin: -25px 0 0 -25px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 7px solid #ffffff; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-top: 7px solid transparent;
border-radius: 50%;
animation: spin 1s linear infinite;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
/* Ø¥Ø¶Ø§ÙØ© ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±ÙŠØ¶Ø© */
@media (min-width: 1024px) {
body {
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.container {
max-width: 1400px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
margin: 28px auto; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

form {
padding: 56px 70px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.three-col-checks {
flex-direction: row;
gap: 35px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.check-col {
flex: 1;
}

select, input, textarea {
font-size: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 22px 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 77px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group label {
font-size: 1.4rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
padding: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 77px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}

.checkbox-group input[type="checkbox"] {
width: 28px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
height: 28px;
margin-left: 21px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border-radius: 4px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
border: 3px solid #ccc; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
h2 {
font-size: 2.52rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
.step-btn {
font-size: 1.4rem; /* Ø²ÙŠØ§Ø¯Ø© 40% */
min-height: 91px; /* Ø²ÙŠØ§Ø¯Ø© 40% */
}
}
</style>
</head>
<body>
<!-- Ù…Ø¤Ø´Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ -->
<div class="offline-indicator" id="offlineIndicator">
ğŸ”Œ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¹ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
</div>
<!-- Ø´Ø±ÙŠØ· Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
<div class="user-info-bar" id="userInfoBar">
<div class="saved-info">
âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: <span id="savedUserInfo"></span>
</div>
</div>
<!-- Ø²Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<button class="install-prompt" id="installPrompt">
ğŸ“± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
</button>
<!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ«Ø¨ÙŠØª -->
<div class="install-modal" id="installModal">
<div class="install-modal-content">
<h3>ğŸ“± ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ØµØ©</h3>
<p>Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒØŒ Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>

<div id="androidInstructions" style="display: none;">
<h4>ğŸ“± Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ (Chrome):</h4>
<ol class="install-steps">
<li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© â‹® ÙÙŠ Ø£Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† Ø§Ù„Ù…ØªØµÙØ­</li>
<li>Ø§Ø®ØªØ± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" Ø£Ùˆ "ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"</li>
<li>Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ©" Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ«Ø¨ÙŠØª</li>
<li>Ø³ØªØ¬Ø¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
</ol>
</div>

<div id="iosInstructions" style="display: none;">
<h4>ğŸ“± Ù„Ù„Ø¢ÙŠÙÙˆÙ† (Safari):</h4>
<ol class="install-steps">
<li>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ğŸ“¤ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©</li>
<li>Ù…Ø±Ø± Ù„Ø£Ø³ÙÙ„ ÙˆØ§Ø®ØªØ± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"</li>
<li>Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ø§Ù‹ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ©"</li>
<li>Ø³ØªØ¬Ø¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
</ol>
</div>

<div id="generalInstructions">
<h4>ğŸ“± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¹Ø§Ù…Ø©:</h4>
<ol class="install-steps">
<li>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®ÙŠØ§Ø± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" ÙÙŠ Ù…ØªØµÙØ­Ùƒ</li>
<li>Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† "ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙØ­</li>
<li>Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙŠ ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©</li>
</ol>
</div>

<div class="modal-buttons">
<button class="modal-btn primary" id="tryInstallBtn">ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¢Ù†</button>
<button class="modal-btn secondary" id="closeModalBtn">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
</div>
</div>
<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="loadingIndicator" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
  <div style="width: 70px; height: 70px; border: 8px solid #f3f3f3; border-top: 8px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
  <p style="margin-top: 20px; font-size: 1.5rem; color: #667eea; font-weight: 600;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
</div>

<div class="container">
<h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­ØµØ©</h2>
<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª -->
<div class="steps-nav">
<button type="button" class="step-btn active" data-step="1">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©</button>
<button type="button" class="step-btn" data-step="2">Ø­ØµØ© Ø§Ù„Ù‚Ø±Ø¢Ù†</button>
<button type="button" class="step-btn" data-step="3">Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</button>
<button type="button" class="step-btn hidden" data-step="4">Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</button>
<button type="button" class="step-btn" data-step="5">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©</button>
</div>
<form id="mainForm" novalidate>
<!-- ========== Ø§Ù„ØµÙØ­Ø© 1: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø© ========== -->
<div class="form-step active" data-step="1">
<label>Ø§Ù„Ù…Ø¯Ø±Ø³Ø© <span class="required">*</span>
<select id="school" name="school" required></select>
</label>
<label>Ø§Ù„Ù…Ø¹Ù„Ù… <span class="required">*</span>
<input id="teacher" name="teacher" type="text" required autocomplete="name">
</label>
<label>Ø§Ù„ØªØ§Ø±ÙŠØ® <span class="required">*</span>
<input id="date" name="date" type="date" required>
</label>
<label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span class="required">*</span>
<select id="level" name="level" required></select>
</label>
<label>Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ø³Ù… <span class="required">*</span>
<select id="section" name="section" required></select>
</label>
<div class="form-navigation">
<div></div>
<button type="button" id="btnNext1">Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
</div>
</div>
<!-- ========== Ø§Ù„ØµÙØ­Ø© 2: Ø­ØµØ© Ø§Ù„Ù‚Ø±Ø¢Ù† ========== -->
<div class="form-step" data-step="2">
<label>ØªÙ‚Ø±ÙŠØ± Ø­ØµØ© Ø§Ù„Ù‚Ø±Ø¢Ù† <span class="small">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
<textarea id="quranReport" name="quranReport" rows="4" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ± Ø­ØµØ© Ø§Ù„Ù‚Ø±Ø¢Ù† Ù‡Ù†Ø§..."></textarea>
</label>
<div class="form-navigation">
<button type="button" id="btnPrev2">â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
<button type="button" id="btnNext2">Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
</div>
</div>
<!-- ========== Ø§Ù„ØµÙØ­Ø© 3: Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ========== -->
<div class="form-step" data-step="3">
<h3>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰</h3>
<label>Ø§Ù„Ù…Ø§Ø¯Ø© <span class="required">*</span>
<select id="subject1" name="subject1" required></select>
</label>
<div id="genderDiv1" class="hidden gender-field">
<label>Ø§Ù„Ø¬Ù†Ø³ <span class="required">*</span>
<select id="gender1" name="gender1">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
<option value="Ø°ÙƒÙˆØ±">Ø°ÙƒÙˆØ±</option>
<option value="Ø¥Ù†Ø§Ø«">Ø¥Ù†Ø§Ø«</option>
</select>
</label>
</div>
<label>Ø§Ù„Ø¯Ø±Ø³ <span class="required">*</span>
<select id="lesson1" name="lesson1" required></select>
</label>
<!-- Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…ØªØ¬Ø§ÙˆØ±Ø© Ù…Ø¹ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„checkbox. -->
<div class="three-col-checks">
<div class="check-col">
<h4>Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ¯Ø±ÙŠØ³ <span class="required">*</span></h4>
<div id="strategy1" class="checkbox-group"></div>
</div>
<div class="check-col">
<h4>Ø§Ù„ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© <span class="required">*</span></h4>
<div id="tools1" class="checkbox-group"></div>
</div>
<div class="check-col">
<h4>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø© <span class="required">*</span></h4>
<div id="tasks1" class="checkbox-group"></div>
</div>
</div>
<!-- Ø³Ø¤Ø§Ù„ "Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø­ØµØ© Ø«Ø§Ù†ÙŠØ©" ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ -->
<hr>
<label>Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø­ØµØ© Ø«Ø§Ù†ÙŠØ©ØŸ <span class="required">*</span>
<select id="hasSecond" name="hasSecond" required>
<option value="">Ø§Ø®ØªØ±</option>
<option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
<option value="Ù„Ø§">Ù„Ø§</option>
</select>
</label>
<div class="form-navigation">
<button type="button" id="btnPrev3">â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
<button type="button" id="btnNext3">Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
</div>
</div>
<!-- ========== Ø§Ù„ØµÙØ­Ø© 4: Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ========== -->
<div class="form-step" data-step="4">
<h3>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</h3>
<label>Ø§Ù„Ù…Ø§Ø¯Ø© <span class="required">*</span>
<select id="subject2" name="subject2"></select>
</label>
<div id="genderDiv2" class="hidden gender-field">
<label>Ø§Ù„Ø¬Ù†Ø³ <span class="required">*</span>
<select id="gender2" name="gender2">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
<option value="Ø°ÙƒÙˆØ±">Ø°ÙƒÙˆØ±</option>
<option value="Ø¥Ù†Ø§Ø«">Ø¥Ù†Ø§Ø«</option>
</select>
</label>
</div>
<label>Ø§Ù„Ø¯Ø±Ø³ <span class="required">*</span>
<select id="lesson2" name="lesson2"></select>
</label>
<div class="three-col-checks">
<div class="check-col">
<h4>Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ¯Ø±ÙŠØ³ <span class="required">*</span></h4>
<div id="strategy2" class="checkbox-group"></div>
</div>
<div class="check-col">
<h4>Ø§Ù„ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© <span class="required">*</span></h4>
<div id="tools2" class="checkbox-group"></div>
</div>
<div class="check-col">
<h4>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø© <span class="required">*</span></h4>
<div id="tasks2" class="checkbox-group"></div>
</div>
</div>
<div class="form-navigation">
<button type="button" id="btnPrev4">â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
<button type="button" id="btnNext4">Ø§Ù„ØªØ§Ù„ÙŠ â†</button>
</div>
</div>
<!-- ========== Ø§Ù„ØµÙØ­Ø© 5: Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø© ========== -->
<div class="form-step" data-step="5">
<h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©</h3>
<label>Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­ØµØ© <span class="small">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
<textarea id="notes" name="notes" rows="5" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­ØµØ© Ù‡Ù†Ø§..."></textarea>
</label>
<div class="form-navigation">
<button type="button" id="btnPrev5">â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
<button type="submit" class="submit-btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>
</div>
</form>
</div>
<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="loadingIndicator" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
<div style="width: 70px; height: 70px; border: 8px solid #f3f3f3; border-top: 8px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
<p style="margin-top: 20px; font-size: 1.5rem; color: #667eea; font-weight: 600;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
</div>

<script>
/* ========== Enhanced PWA Features ========== */
let deferredPrompt;
let isOnline = navigator.onLine;
let pendingData = JSON.parse(localStorage.getItem('pendingReports') || '[]');
let savedUserData = JSON.parse(localStorage.getItem('savedUserData') || '{}');

// Detect device type for install instructions
function detectDevice() {
    const userAgent = navigator.userAgent;
    if (/Android/i.test(userAgent)) return 'android';
    if (/iPhone|iPad|iPod/i.test(userAgent)) return 'ios';
    return 'general';
}

// Show appropriate install instructions
function showInstallInstructions() {
    const device = detectDevice();
    const modal = document.getElementById('installModal');
    const androidInstructions = document.getElementById('androidInstructions');
    const iosInstructions = document.getElementById('iosInstructions');
    const generalInstructions = document.getElementById('generalInstructions');

    // Hide all instruction sets first
    androidInstructions.style.display = 'none';
    iosInstructions.style.display = 'none';
    generalInstructions.style.display = 'none';

    // Show appropriate instructions
    if (device === 'android') {
        androidInstructions.style.display = 'block';
    } else if (device === 'ios') {
        iosInstructions.style.display = 'block';
    } else {
        generalInstructions.style.display = 'block';
    }

    modal.classList.add('show');
}

// Service Worker Registration
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        const swCode = `
            const CACHE_NAME = 'report-app-v2';
            const urlsToCache = [
                './',
                '/manifest.json'
            ];

            self.addEventListener('install', function(event) {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                    .then(function(cache) {
                        return cache.addAll(urlsToCache);
                    })
                );
                self.skipWaiting();
            });

            self.addEventListener('fetch', function(event) {
                event.respondWith(
                    caches.match(event.request)
                    .then(function(response) {
                        if (response) {
                            return response;
                        }
                        return fetch(event.request);
                    })
                );
            });

            self.addEventListener('activate', function(event) {
                event.waitUntil(
                    caches.keys().then(function(cacheNames) {
                        return Promise.all(
                            cacheNames.map(function(cacheName) {
                                if (cacheName !== CACHE_NAME) {
                                    return caches.delete(cacheName);
                                }
                            })
                        );
                    })
                );
            });
        `;
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        navigator.serviceWorker.register(swUrl)
            .then(function(registration) {
                console.log('ServiceWorker registration successful');

                // Check for updates
                registration.addEventListener('updatefound', () => {
                    console.log('New version available');
                });
            })
            .catch(function(err) {
                console.log('ServiceWorker registration failed');
            });
    });
}

// PWA Install Prompt
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById('installPrompt').classList.add('show');
});

// Install button click handlers
document.getElementById('installPrompt').addEventListener('click', showInstallInstructions);
document.getElementById('tryInstallBtn').addEventListener('click', () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((result) => {
            if (result.outcome === 'accepted') {
                console.log('User accepted PWA install');
                document.getElementById('installPrompt').classList.remove('show');
                document.getElementById('installModal').classList.remove('show');
            }
            deferredPrompt = null;
        });
    } else {
        // Fallback for browsers that don't support the install prompt
        alert('Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ù…ØªØµÙØ­Ùƒ');
        document.getElementById('installModal').classList.remove('show');
    }
});
document.getElementById('closeModalBtn').addEventListener('click', () => {
    document.getElementById('installModal').classList.remove('show');
});

// Close modal when clicking outside
document.getElementById('installModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('installModal')) {
        document.getElementById('installModal').classList.remove('show');
    }
});

// Online/Offline Detection
window.addEventListener('online', () => {
    isOnline = true;
    document.getElementById('offlineIndicator').classList.remove('show');
    syncPendingData();
});
window.addEventListener('offline', () => {
    isOnline = false;
    document.getElementById('offlineIndicator').classList.add('show');
});

// Initial online status check
if (!isOnline) {
    document.getElementById('offlineIndicator').classList.add('show');
}

// Save user data functionality (without date)
function saveUserData() {
    const userData = {
        school: document.getElementById('school').value,
        teacher: document.getElementById('teacher').value,
        level: document.getElementById('level').value,
        section: document.getElementById('section').value,
        lastSaved: new Date().toISOString()
    };
    
    // Only save if all required fields except date are filled
    if (userData.school && userData.teacher && userData.level && userData.section) {
        localStorage.setItem('savedUserData', JSON.stringify(userData));
        showUserInfoBar(userData);
    }
}

function loadUserData() {
    if (Object.keys(savedUserData).length > 0 && savedUserData.school) {
        document.getElementById('school').value = savedUserData.school || '';
        document.getElementById('teacher').value = savedUserData.teacher || '';
        document.getElementById('level').value = savedUserData.level || '';
        document.getElementById('section').value = savedUserData.section || '';
        // Note: Date is intentionally left empty
        showUserInfoBar(savedUserData);
        
        // Update subjects based on saved level
        if (savedUserData.level) {
            const subs = subjectsForLevel(savedUserData.level);
            populateSelect('subject1', subs);
            populateSelect('subject2', subs);
        }
    }
}

function showUserInfoBar(userData) {
    const userInfoBar = document.getElementById('userInfoBar');
    const savedUserInfo = document.getElementById('savedUserInfo');
    if (userData.school && userData.teacher) {
        savedUserInfo.textContent = `${userData.teacher} - ${userData.school}`;
        userInfoBar.classList.add('show');
        // Hide after 5 seconds
        setTimeout(() => {
            userInfoBar.classList.remove('show');
        }, 5000);
    }
}

// Auto-save user data when fields change (without date)
['school', 'teacher', 'level', 'section'].forEach(fieldId => {
    document.getElementById(fieldId).addEventListener('change', saveUserData);
});

function syncPendingData() {
    if (pendingData.length > 0 && isOnline) {
        pendingData.forEach(data => {
            // Try to submit pending data
            submitToServer(data).then(() => {
                // Remove from pending on success
                pendingData = pendingData.filter(item => item !== data);
                localStorage.setItem('pendingReports', JSON.stringify(pendingData));
            }).catch(err => {
                console.log('Failed to sync:', err);
            });
        });
    }
}

function submitToServer(payload) {
    return new Promise((resolve, reject) => {
        if (typeof google !== 'undefined' && google.script && google.script.run) {
            google.script.run
                .withSuccessHandler(resolve)
                .withFailureHandler(reject)
                .submitForm(payload);
        } else {
            // Simulate server submission
            setTimeout(() => {
                Math.random() > 0.2 ? resolve('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­') : reject(new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„'));
            }, 1000);
        }
    });
}

/* ========== Original Form Logic ========== */
const $ = id => document.getElementById(id);
let currentStep = 1;
let maxSteps = 5;
let completedSteps = new Set();
let hasSecondLesson = false;

// Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®Ø·ÙˆØ§Øª
const stepButtons = document.querySelectorAll('.step-btn');
stepButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        const step = parseInt(btn.dataset.step, 10);
        if (step === 4 && !hasSecondLesson) {
            return;
        }
        showStep(step);
    });
});

function showStep(step) {
    document.querySelectorAll('.form-step').forEach(stepDiv => {
        stepDiv.classList.remove('active');
    });

    const target = document.querySelector(`.form-step[data-step="${step}"]`);
    if (target) {
        target.classList.add('active');
        window.scrollTo(0, 0);
    }
    
    stepButtons.forEach(b => {
        b.classList.remove('active');
        if (completedSteps.has(parseInt(b.dataset.step))) {
            b.classList.add('completed');
        } else {
            b.classList.remove('completed');
        }
    });
    
    const curBtn = document.querySelector(`.step-btn[data-step="${step}"]`);
    if (curBtn) {
        curBtn.classList.add('active');
        curBtn.classList.remove('completed');
    }
    
    currentStep = step;
}

function nextStep() {
    let nextStepNum = currentStep + 1;
    
    // ØªØ¬Ø§ÙˆØ² Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø­ØµØ© Ø«Ø§Ù†ÙŠØ©
    if (nextStepNum === 4 && document.getElementById('hasSecond').value === 'Ù„Ø§') {
        nextStepNum = 5;
    }
    
    if (nextStepNum <= maxSteps) {
        completedSteps.add(currentStep);
        showStep(nextStepNum);
    }
}

function prevStep() {
    let prevStepNum = currentStep - 1;
    if (prevStepNum === 4 && !hasSecondLesson) {
        prevStepNum = 3;
    }
    if (prevStepNum >= 1) {
        showStep(prevStepNum);
    }
}

// Event listeners for navigation buttons
$('btnNext1').addEventListener('click', () => {
    if (validateStep1()) nextStep();
});
$('btnNext2').addEventListener('click', () => {
    nextStep();
});
// Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø­Ø¯Ø« Ù„Ø²Ø± "Ø§Ù„ØªØ§Ù„ÙŠ" ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
$('btnNext3').addEventListener('click', function() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø³Ø¤Ø§Ù„ "Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø­ØµØ© Ø«Ø§Ù†ÙŠØ©ØŸ"
    const hasSecondValue = document.getElementById('hasSecond').value;
    
    if (hasSecondValue === 'Ù„Ø§') {
        // Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ù„Ø§"ØŒ Ø§Ù†ØªÙ‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©)
        showStep(5);
    } else {
        // Ø¥Ø°Ø§ Ø§Ø®ØªØ§Ø± "Ù†Ø¹Ù…"ØŒ Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© (Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©)
        nextStep();
    }
});
$('btnNext4').addEventListener('click', () => {
    if (validateStep4()) nextStep();
});
$('btnPrev2').addEventListener('click', () => prevStep());
$('btnPrev3').addEventListener('click', () => prevStep());
$('btnPrev4').addEventListener('click', () => prevStep());
$('btnPrev5').addEventListener('click', () => prevStep());

/* ========== Validation Functions ========== */
function validateStep1(){
    if (!$('school').value || !$('teacher').value || !$('date').value || !$('level').value || !$('section').value) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©');
        return false;
    }
    return true;
}

function validateStep3() {
    if (!$('subject1').value || !$('lesson1').value || !$('hasSecond').value) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (checkedValues('strategy1').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (checkedValues('tools1').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (checkedValues('tasks1').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (!$('genderDiv1').classList.contains('hidden') && !$('gender1').value) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    return true;
}

function validateStep4() {
    if (!hasSecondLesson) return true;
    if (!$('subject2').value || !$('lesson2').value) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
        return false;
    }
    if (checkedValues('strategy2').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
        return false;
    }
    if (checkedValues('tools2').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
        return false;
    }
    if (checkedValues('tasks2').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
        return false;
    }
    if (!$('genderDiv2').classList.contains('hidden') && !$('gender2').value) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
        return false;
    }
    return true;
}

/* ========== Form Data Logic ========== */
let FORM_LISTS = {};
let LESSONS = [];

function escapeHtml(s){
    return (s || '').toString().replace(/[&<>"'`]/g, c => ({
        '&':'&','<':'<','>':'>','"':'"',"'":'&apos;','`':'&#96;'
    }[c]));
}

function normSubj(s){
    return (s || '').toString().trim().replace(/^\s*\u0627\u0644/,'').toLowerCase();
}

function unique(arr){
    return Array.from(new Set(arr));
}

function populateSelect(id, items, includePlaceholder=true){
    const el = $(id);
    if(!el) return;
    let html = includePlaceholder ? '<option value="">Ø§Ø®ØªØ±</option>' : '';
    items.forEach(v => {
        html += `<option value="${escapeHtml(v)}">${escapeHtml(v)}</option>`;
    });
    el.innerHTML = html;
}

function createCheckboxes(containerId, items) {
    const cont = $(containerId);
    if(!cont) return;
    cont.innerHTML = '';
    (items||[]).forEach((it, i) => {
        const id = containerId + '_cb_' + i;
        const label = document.createElement('label');
        const cb = document.createElement('input');
        const span = document.createElement('span');
        cb.type = 'checkbox';
        cb.value = it;
        cb.id = id;
        cb.name = containerId;
        span.textContent = it;
        label.appendChild(cb);
        label.appendChild(span);
        cont.appendChild(label);
    });
}

function checkedValues(containerId){
    const cont = $(containerId);
    if(!cont) return [];
    return Array.from(cont.querySelectorAll('input[type=checkbox]:checked')).map(x => x.value);
}

function updateSecondLessonVisibility() {
    const step4Btn = document.querySelector('.step-btn[data-step="4"]');
    if (hasSecondLesson) {
        step4Btn.classList.remove('hidden');
        maxSteps = 5;
    } else {
        step4Btn.classList.add('hidden');
        maxSteps = 4;
        if (currentStep === 4) {
            showStep(5);
        }
    }
}

function loadMockData() {
    FORM_LISTS = {
        schools: ['Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ù…Ù„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©', 'Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†ÙˆØ± Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©', 'Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„'],
        levels: ['Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„Ø®Ø§Ù…Ø³Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', 'Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…ØªÙˆØ³Ø·', 'Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ù…ØªÙˆØ³Ø·', 'Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ù…ØªÙˆØ³Ø·', 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·', 'Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ', 'Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø«Ø§Ù†ÙˆÙŠ'],
        sections: ['Ø£', 'Ø¨', 'Ø¬', 'Ø¯', 'Ù‡Ù€'],
        strategies: ['Ø§Ù„Ø¹ØµÙ Ø§Ù„Ø°Ù‡Ù†ÙŠ', 'Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ', 'Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª', 'Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù†Ø´Ø·', 'Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© ÙˆØ§Ù„Ø­ÙˆØ§Ø±'],
        tools: ['Ø§Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ©', 'Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠØ©', 'Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ', 'Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ø°Ù‡Ù†ÙŠØ©', 'Ø§Ù„ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ø³Ù…Ø¹ÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©'],
        tasks: ['Ø´Ø±Ø­ Ø§Ù„Ø¯Ø±Ø³', 'Ø­Ù„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†', 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ', 'Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªÙƒÙˆÙŠÙ†ÙŠ', 'Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©']
    };
    LESSONS = [
        { level: 'Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', subjectOriginal: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', subjectNorm: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', title: 'Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ù† 1 Ø¥Ù„Ù‰ 10', gender: '' },
        { level: 'Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', subjectOriginal: 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', subjectNorm: 'Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©', title: 'Ø­Ø±ÙˆÙ Ø§Ù„Ù‡Ø¬Ø§Ø¡', gender: '' },
        { level: 'Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ', subjectOriginal: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', subjectNorm: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª', title: 'Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø·Ø±Ø­', gender: '' },
        { level: 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·', subjectOriginal: 'Ø§Ù„ÙÙ‚Ù‡', subjectNorm: 'ÙÙ‚Ù‡', title: 'Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ø·Ù‡Ø§Ø±Ø© Ù„Ù„Ø¨Ù†Ø§Øª', gender: 'Ø¥Ù†Ø§Ø«' },
        { level: 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·', subjectOriginal: 'Ø§Ù„ÙÙ‚Ù‡', subjectNorm: 'ÙÙ‚Ù‡', title: 'Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„Ø¨Ù†ÙŠÙ†', gender: 'Ø°ÙƒÙˆØ±' }
    ];
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„ Ø£ÙØ¶Ù„
function showLoading(show = true) {
    const loadingIndicator = document.getElementById('loadingIndicator');
    if (loadingIndicator) {
        loadingIndicator.style.display = show ? 'flex' : 'none';
    }
}

// ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function loadData() {
    showLoading(true);
    if (typeof google !== 'undefined' && google.script && google.script.run) {
        google.script.run.withSuccessHandler(payload => {
            try {
                const lists = payload.lists || {};
                FORM_LISTS = {
                    schools:     lists.schools    || [],
                    levels:      lists.levels     || [],
                    sections:    lists.sections   || [],
                    strategies:  lists.strategies || [],
                    tools:       lists.tools      || [],
                    tasks:       lists.tasks      || []
                };
                LESSONS = (payload.lessons || []).map(l => ({
                    level: l.level || '',
                    subjectOriginal: l.subjectOriginal || '',
                    subjectNorm: (l.subjectNorm || '').toLowerCase(),
                    title: l.title || '',
                    gender: (l.gender || '').toString().trim()
                }));
                initializeForm();
            } catch (error) {
                console.error('Error processing form data:', error);
                alert('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
                loadMockData();
                initializeForm();
            } finally {
                showLoading(false);
            }
        }).withFailureHandler(err => {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err);
            alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + err.message);
            loadMockData();
            initializeForm();
            showLoading(false);
        }).getFormData();
    } else {
        loadMockData();
        initializeForm();
        showLoading(false);
    }
}

function initializeForm() {
    try {
        populateSelect('school', FORM_LISTS.schools);
        populateSelect('level', FORM_LISTS.levels);
        populateSelect('section', FORM_LISTS.sections);
        createCheckboxes('strategy1', FORM_LISTS.strategies);
        createCheckboxes('tools1', FORM_LISTS.tools);
        createCheckboxes('tasks1', FORM_LISTS.tasks);
        createCheckboxes('strategy2', FORM_LISTS.strategies);
        createCheckboxes('tools2', FORM_LISTS.tools);
        createCheckboxes('tasks2', FORM_LISTS.tasks);
        
        // Note: Removed automatic date setting
        // Date field will be left empty
        
        // Load saved user data (without date)
        loadUserData();
    } catch (error) {
        console.error('Error initializing form:', error);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ' + error.message);
    }
}

function subjectsForLevel(level){
    const map = new Map();
    LESSONS.forEach(l => {
        if (l.level === level) {
            const key = l.subjectNorm || normSubj(l.subjectOriginal);
            if (!map.has(key)) {
                map.set(key, l.subjectOriginal);
            }
        }
    });
    return Array.from(map.values());
}

function lessonsFor(level, subjectOriginal, gender='') {
    if(!level || !subjectOriginal) return [];
    const subjectKey = normSubj(subjectOriginal);
    const needGenderFilter = (level === 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·' && subjectKey === 'ÙÙ‚Ù‡');
    return unique(LESSONS
        .filter(l => l.level === level && l.subjectNorm === subjectKey)
        .filter(l => {
            if (!needGenderFilter) return true;
            if (!l.gender) return true;
            return (gender && l.gender === gender);
        })
        .map(l => l.title)
    );
}

// Event listeners for form changes
$('level').addEventListener('change', () => {
    const levelVal = $('level').value;
    const subs = subjectsForLevel(levelVal);
    populateSelect('subject1', subs);
    populateSelect('subject2', subs);
    populateSelect('lesson1', []);
    populateSelect('lesson2', []);
    $('genderDiv1').classList.add('hidden');
    $('genderDiv2').classList.add('hidden');
    $('gender1').value = '';
    $('gender2').value = '';
});

$('subject1').addEventListener('change', () => {
    const levelVal = $('level').value;
    const subj = $('subject1').value;
    const needGender = (levelVal === 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·' && normSubj(subj) === 'ÙÙ‚Ù‡');
    if (needGender) {
        $('genderDiv1').classList.remove('hidden');
        populateSelect('lesson1', []);
        $('gender1').value = '';
    } else {
        $('genderDiv1').classList.add('hidden');
        $('gender1').value = '';
        populateSelect('lesson1', lessonsFor(levelVal, subj));
    }
});

$('gender1').addEventListener('change', () => {
    const levelVal = $('level').value;
    const subj = $('subject1').value;
    const g = $('gender1').value;
    populateSelect('lesson1', lessonsFor(levelVal, subj, g));
});

$('hasSecond').addEventListener('change', () => {
    hasSecondLesson = $('hasSecond').value === 'Ù†Ø¹Ù…';
    updateSecondLessonVisibility();
    ['subject2','lesson2'].forEach(id => {
        if (hasSecondLesson) {
            $(id).setAttribute('required','required');
        } else {
            $(id).removeAttribute('required');
            populateSelect('lesson2', []);
            $('genderDiv2').classList.add('hidden');
            $('gender2').value = '';
        }
    });
});

$('subject2').addEventListener('change', () => {
    const levelVal = $('level').value;
    const subj2 = $('subject2').value;
    const needGender = (levelVal === 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ù…ØªÙˆØ³Ø·' && normSubj(subj2) === 'ÙÙ‚Ù‡');
    if (needGender) {
        $('genderDiv2').classList.remove('hidden');
        populateSelect('lesson2', []);
        $('gender2').value = '';
    } else {
        $('genderDiv2').classList.add('hidden');
        $('gender2').value = '';
        populateSelect('lesson2', lessonsFor(levelVal, subj2));
    }
});

$('gender2').addEventListener('change', () => {
    const levelVal = $('level').value;
    const subj2 = $('subject2').value;
    const g2 = $('gender2').value;
    populateSelect('lesson2', lessonsFor(levelVal, subj2, g2));
});

function validateForm() {
    if (!document.getElementById('mainForm').checkValidity()) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
        return false;
    }
    if (checkedValues('strategy1').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (checkedValues('tools1').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (checkedValues('tasks1').length === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (!document.getElementById('genderDiv1').classList.contains('hidden') && !document.getElementById('gender1').value) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰');
        return false;
    }
    if (hasSecondLesson) {
        if (!$('subject2').value) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø§Ø¯Ø© Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
            return false;
        }
        if (!$('lesson2').value) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø³ Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
            return false;
        }
        if (checkedValues('strategy2').length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
            return false;
        }
        if (checkedValues('tools2').length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
            return false;
        }
        if (checkedValues('tasks2').length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‡Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
            return false;
        }
        if (!document.getElementById('genderDiv2').classList.contains('hidden') && !document.getElementById('gender2').value) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³ Ù„Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©');
            return false;
        }
    }
    return true;
}

function resetForm() {
    // Get current user data before reset (without date)
    const currentUserData = {
        school: $('school').value,
        teacher: $('teacher').value,
        level: $('level').value,
        section: $('section').value
    };
    
    // Reset the entire form
    document.getElementById('mainForm').reset();
    populateSelect('lesson1', []);
    populateSelect('lesson2', []);
    document.getElementById('genderDiv1').classList.add('hidden');
    document.getElementById('genderDiv2').classList.add('hidden');
    hasSecondLesson = false;
    updateSecondLessonVisibility();
    completedSteps.clear();
    showStep(1);
    
    // Restore user data (except date)
    $('school').value = currentUserData.school;
    $('teacher').value = currentUserData.teacher;
    $('level').value = currentUserData.level;
    $('section').value = currentUserData.section;
    
    // Update subjects based on restored level
    if (currentUserData.level) {
        const subs = subjectsForLevel(currentUserData.level);
        populateSelect('subject1', subs);
        populateSelect('subject2', subs);
    }
    
    // Note: Date is intentionally left empty
}

// Form submission
document.getElementById('mainForm').addEventListener('submit', function(e) {
    e.preventDefault();
    if (!validateForm()) return;
    
    const payload = {
        school: $('school').value,
        teacher: $('teacher').value,
        date: $('date').value,
        quranReport: $('quranReport').value || '',
        level: $('level').value,
        section: $('section').value,
        subject1: $('subject1').value,
        lesson1: $('lesson1').value,
        strategy1: checkedValues('strategy1').join('ØŒ '),
        tools1: checkedValues('tools1').join('ØŒ '),
        tasks1: checkedValues('tasks1').join('ØŒ '),
        hasSecond: $('hasSecond').value,
        subject2: hasSecondLesson ? $('subject2').value : '',
        lesson2: hasSecondLesson ? $('lesson2').value : '',
        strategy2: hasSecondLesson ? checkedValues('strategy2').join('ØŒ ') : '',
        tools2: hasSecondLesson ? checkedValues('tools2').join('ØŒ ') : '',
        tasks2: hasSecondLesson ? checkedValues('tasks2').join('ØŒ ') : '',
        notes: document.getElementById('notes').value || '',
        timestamp: new Date().toISOString()
    };
    
    if (!$('genderDiv1').classList.contains('hidden')) {
        payload.gender1 = $('gender1').value;
    }
    if (!$('genderDiv2').classList.contains('hidden')) {
        payload.gender2 = $('gender2').value;
    }
    
    const submitBtn = document.querySelector('.submit-btn');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Ø¬Ø§Ø± Ø§Ù„Ø­ÙØ¸...';
    submitBtn.disabled = true;
    submitBtn.classList.add('loading');
    
    if (isOnline) {
        submitToServer(payload)
            .then(msg => {
                alert(msg || 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                resetForm();
            })
            .catch(err => {
                // Save to pending if online submission fails
                pendingData.push(payload);
                localStorage.setItem('pendingReports', JSON.stringify(pendingData));
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ø¤Ù‚ØªØ§Ù‹. Ø³ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø¹ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ğŸ“¡');
                resetForm();
            })
            .finally(() => {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            });
    } else {
        // Save to local storage when offline
        pendingData.push(payload);
        localStorage.setItem('pendingReports', JSON.stringify(pendingData));
        setTimeout(() => {
            alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹. Ø³ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø¹ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ğŸ“¡');
            resetForm();
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
            submitBtn.classList.remove('loading');
        }, 1000);
    }
});

// Prevent Enter key navigation except in textarea
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
        const form = e.target.form;
        if (form) {
            const index = Array.prototype.indexOf.call(form.elements, e.target);
            const nextElement = form.elements[index + 1];
            if (nextElement && !nextElement.disabled) {
                nextElement.focus();
            }
        }
    }
});

// Initialize app
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadData);
} else {
    loadData();
}

// Try to sync pending data on page load
syncPendingData();

// Check if app was installed
window.addEventListener('appinstalled', (evt) => {
    document.getElementById('installPrompt').classList.remove('show');
    console.log('App was installed successfully');
});

// Handle PWA display mode changes
window.addEventListener('beforeunload', () => {
    // Save any pending changes before app closes
    saveUserData();
});

// Add visibility change handler for PWA
document.addEventListener('visibilitychange', () => {
    if (!document.hidden) {
        // App became visible, try to sync pending data
        syncPendingData();
    }
});
</script>
</body>
</html>